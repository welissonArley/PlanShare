<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="PlanShare.App.Views.Pages.User.Connection.UserConnectionGeneratorPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:PlanShare.App.Converters"
    xmlns:fontFamily="clr-namespace:PlanShare.App.Constants"
    xmlns:models="clr-namespace:PlanShare.App.Models"
    xmlns:resourceTexts="clr-namespace:PlanShare.App.Resources"
    xmlns:skeletonLoading="clr-namespace:PlanShare.App.Views.Components.Skeletons"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewModel="clr-namespace:PlanShare.App.ViewModels.Pages.User.Connection"
    x:Name="PageUserConnectionGenerator"
    x:DataType="viewModel:UserConnectionGeneratorViewModel">
    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior Command="{Binding Path=BindingContext.InitializeCommand, Source={Reference PageUserConnectionGenerator}}" EventName="Appearing" />
    </ContentPage.Behaviors>

    <ContentPage.Resources>
        <converters:NameToAvatarNameConverter x:Key="nameToAvatarName" />
    </ContentPage.Resources>

    <VerticalStackLayout>
        <VerticalStackLayout>
            <VerticalStackLayout.Triggers>
                <DataTrigger
                    Binding="{Binding StatusPage}"
                    TargetType="VerticalStackLayout"
                    Value="{Static models:ConnectionByCodeStatusPage.JoinerConnectedPendingApproval}">
                    <Setter Property="IsVisible" Value="False" />
                </DataTrigger>
            </VerticalStackLayout.Triggers>

            <Image HorizontalOptions="Center" Source="sweetcat.png" />

            <Label
                Margin="0,50,0,10"
                Style="{StaticResource PageTitle}"
                Text="{Static resourceTexts:ResourceTexts.TITLE_SHARE_TASK}" />

            <Label Text="{Static resourceTexts:ResourceTexts.SUBTITLE_CONNECTION_BY_CODE}" />

            <skeletonLoading:SkeletonView
                Margin="0,30,0,40"
                HeightRequest="50"
                IsVisible="False"
                WidthRequest="230">
                <skeletonLoading:SkeletonView.Triggers>
                    <DataTrigger
                        Binding="{Binding StatusPage}"
                        TargetType="skeletonLoading:SkeletonView"
                        Value="{Static models:ConnectionByCodeStatusPage.GeneratingCode}">
                        <Setter Property="IsVisible" Value="True" />
                    </DataTrigger>
                </skeletonLoading:SkeletonView.Triggers>
            </skeletonLoading:SkeletonView>

            <Label
                Margin="0,30,0,40"
                FontFamily="{Static fontFamily:FontFamily.MAIN_FONT_BLACK}"
                FontSize="60"
                HorizontalOptions="Center"
                IsVisible="False"
                Text="{Binding ConnectionCode}">
                <Label.Triggers>
                    <DataTrigger
                        Binding="{Binding StatusPage}"
                        TargetType="Label"
                        Value="{Static models:ConnectionByCodeStatusPage.WaitingForJoiner}">
                        <Setter Property="IsVisible" Value="True" />
                    </DataTrigger>
                </Label.Triggers>
            </Label>

            <BoxView HeightRequest="1" Color="{AppThemeBinding Light={StaticResource LINES_COLOR_LIGHT}, Dark={StaticResource LINES_COLOR_DARK}}" />

            <Button
                Margin="0,70,0,0"
                Command="{Binding CancelCommand}"
                IsVisible="False"
                Style="{StaticResource DangerousButtonStyle}"
                Text="{Static resourceTexts:ResourceTexts.TITLE_CANCEL_OPERATION}">
                <Button.Triggers>
                    <DataTrigger
                        Binding="{Binding StatusPage}"
                        TargetType="Button"
                        Value="{Static models:ConnectionByCodeStatusPage.WaitingForJoiner}">
                        <Setter Property="IsVisible" Value="True" />
                    </DataTrigger>
                </Button.Triggers>
            </Button>
        </VerticalStackLayout>

        <VerticalStackLayout Margin="0,40,0,0" IsVisible="False">
            <VerticalStackLayout.Triggers>
                <DataTrigger
                    Binding="{Binding StatusPage}"
                    TargetType="VerticalStackLayout"
                    Value="{Static models:ConnectionByCodeStatusPage.JoinerConnectedPendingApproval}">
                    <Setter Property="IsVisible" Value="True" />
                </DataTrigger>
            </VerticalStackLayout.Triggers>

            <toolkit:AvatarView
                BackgroundColor="{AppThemeBinding Light={StaticResource AVATAR_COLOR_LIGHT},
                                                  Dark={StaticResource AVATAR_COLOR_DARK}}"
                BorderWidth="0"
                CornerRadius="50"
                FontFamily="{Static fontFamily:FontFamily.MAIN_FONT_BLACK}"
                FontSize="24"
                HeightRequest="100"
                Text="{Binding JoinerUser.Name, Converter={StaticResource nameToAvatarName}}"
                TextColor="{AppThemeBinding Light={StaticResource SECONDARY_COLOR_LIGHT},
                                            Dark={StaticResource SECONDARY_COLOR_DARK}}"
                WidthRequest="100" />

            <Label
                Margin="0,20,0,0"
                FontFamily="{Static fontFamily:FontFamily.MAIN_FONT_BLACK}"
                FontSize="30"
                HorizontalOptions="Center"
                HorizontalTextAlignment="Center"
                Text="{Binding JoinerUser.Name}" />

            <Button
                Margin="0,70,0,0"
                BackgroundColor="{AppThemeBinding Light={StaticResource HIGHLIGHT_COLOR_LIGHT},
                                                  Dark={StaticResource HIGHLIGHT_COLOR_DARK}}"
                Command="{Binding ApproveCommand}"
                HeightRequest="60"
                Text="{Static resourceTexts:ResourceTexts.TITLE_ACCEPT}"
                TextTransform="Uppercase" />

            <Button
                Margin="0,40,0,0"
                Command="{Binding CancelCommand}"
                Style="{StaticResource DangerousButtonStyle}"
                Text="{Static resourceTexts:ResourceTexts.TITLE_CANCEL_OPERATION}" />

        </VerticalStackLayout>
    </VerticalStackLayout>
</ContentPage>